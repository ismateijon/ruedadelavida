<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Rueda de la Vida – Generador</title>
  <style>
    :root{
      --bg:#f7f7fb; --card:#ffffff; --ink:#111827; --muted:#6b7280; --line:#e5e7eb; --brand:#4f46e5;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial; background:var(--bg); color:var(--ink)}
    .wrap{max-width:1100px;margin:0 auto;padding:24px}
    h1{margin:0 0 6px; font-size:28px}
    h2{margin:0 0 12px; font-size:18px}
    .row{display:flex; gap:12px; flex-wrap:wrap; align-items:center}
    .card{background:var(--card); border-radius:16px; padding:16px; box-shadow:0 6px 20px rgba(0,0,0,.06)}
    .btn{background:var(--brand); color:#fff; padding:10px 14px; border:0; border-radius:12px; cursor:pointer}
    .btn:disabled{opacity:.5; cursor:not-allowed}
    .btn.ghost{background:transparent; color:var(--ink); border:1px solid var(--line)}
    .btn.sm{padding:6px 10px; font-size:12px; border-radius:10px}
    .grid{display:grid; gap:12px}
    .grid.cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}
    .grid.cols-4{grid-template-columns:repeat(4,minmax(0,1fr))}
    @media (max-width: 900px){ .grid.cols-4{grid-template-columns:repeat(2,minmax(0,1fr))} }
    @media (max-width: 560px){ .grid.cols-2,.grid.cols-4{grid-template-columns:repeat(1,minmax(0,1fr))} }
    input[type="text"], select{width:100%; padding:10px 12px; border:1px solid var(--line); border-radius:10px}
    input[type="range"]{width:100%}
    .tiny{font-size:12px; color:var(--muted)}
    .badge{display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border-radius:999px; border:1px solid var(--line); background:#fff; cursor:pointer}
    .dot{display:inline-block; width:10px; height:10px; border-radius:999px}
    canvas{max-width:100%; height:auto; border:1px solid var(--line); border-radius:12px}
    .num{font-variant-numeric:tabular-nums}
  </style>
</head>
<body>
  <div class="wrap">
    <header class="row">
      <div style="flex:1 1 auto; min-width:260px">
        <h1>Rueda de la Vida</h1>
        <p class="tiny">
          Una foto honesta de tu presente para diseñar un futuro con intención.
          La rueda representa 8 áreas claves. Puntuarlas no es juzgarte, es orientarte:
          ver dónde estás para elegir a dónde vas.
        </p>
        <p class="tiny">
          <strong>Cómo rellenarla:</strong> elige 8 áreas importantes, valora <em>cómo estás ahora mismo</em>
          del <strong>0 (desastre)</strong> al <strong>10 (perfecta)</strong>, fija objetivos a 1/3/6/12 meses (el <strong>●</strong>
          marca el objetivo en cada radio) y descarga tu imagen.
        </p>
      </div>
      <div class="row" style="flex:0 0 auto">
        <label class="tiny">Tamaño de la imagen</label>
        <select id="sizeSelect">
          <option value="0.9">Pequeño</option>
          <option value="1.2" selected>Mediano</option>
          <option value="1.6">Grande</option>
        </select>
        <button class="btn" id="downloadBtn">Descargar PNG</button>
      </div>
    </header>

    <section class="card" style="margin-top:16px">
      <h2>1) Elige las 8 áreas</h2>
      <div class="row" style="margin-bottom:10px">
        <span class="tiny">Presets rápidos:</span>
        <button class="btn ghost sm" data-preset="clasica">Clásica</button>
        <button class="btn ghost sm" data-preset="emprendedor">Emprendedor</button>
        <button class="btn ghost sm" data-preset="bienestar">Bienestar</button>
      </div>
      <div class="grid cols-4" id="areasGrid"></div>
    </section>

    <section class="card" style="margin-top:16px">
      <h2>2) Valora cada área (0–10)</h2>
      <div class="row" style="margin-bottom:10px">
        <button class="btn ghost sm" id="all0">Poner todo a 0</button>
        <button class="btn ghost sm" id="all5">Poner todo a 5</button>
        <button class="btn ghost sm" id="all10">Poner todo a 10</button>
      </div>
      <div class="grid cols-4" id="scoresGrid"></div>
    </section>

    <section class="card" style="margin-top:16px">
      <h2>5) Horizonte y objetivos</h2>
      <div class="row" style="margin-bottom:10px">
        <label class="tiny">Horizonte</label>
        <select id="horizon">
          <option value="1">1 mes</option>
          <option value="3" selected>3 meses</option>
          <option value="6">6 meses</option>
          <option value="12">12 meses</option>
        </select>
        <button class="btn ghost sm" id="targets10">Objetivo 10 en todas</button>
        <button class="btn ghost sm" id="targets7">Objetivo 7 en todas</button>
      </div>
      <div class="grid cols-4" id="targetsGrid"></div>
      <p class="tiny" style="margin-top:6px">En la rueda, el objetivo se muestra como un punto ● en el radio de cada área.</p>
    </section>

    <section class="card" style="margin-top:16px">
      <h2>3) Vista previa de la rueda</h2>
      <canvas id="wheelCanvas"></canvas>
      <div class="row" style="margin-top:10px">
        <button class="btn" id="downloadBtn2">4) Descargar imagen (PNG)</button>
        <span class="tiny">Sugerencia: usa tamaño "Grande" para exportar con mayor resolución.</span>
      </div>
    </section>

    <footer class="tiny" style="text-align:center; margin:18px 0">Hecho con ❤️ — Punto de objetivo = ●</footer>
  </div>

  <script>
    // ====== ESTADO ======
    const DEFAULTS = {
      clasica:["Salud","Familia","Pareja","Amigos","Trabajo/Profesión","Finanzas","Crecimiento personal","Ocio/ diversión"],
      emprendedor:["Salud/Energía","Relación de pareja","Familia/Amistades","Negocio/Ingresos","Marca personal","Aprendizaje/Skills","Propósito/Significado","Ocio/Recuperación"],
      bienestar:["Salud física","Salud mental","Relaciones","Trabajo","Dinero","Hogar/Entorno","Hobbies","Espiritualidad"],
    };

    const COLORS = ["#FF6B6B","#FFA500","#FFD93D","#6BCB77","#00C2CB","#4D96FF","#A66DD4","#FF8E9E"];

    let areas = DEFAULTS.clasica.slice(0,8);
    let scores = Array(8).fill(5);
    let targets = Array(8).fill(7);
    let horizon = "3";
    let scale = 1.2; // Mediano por defecto

    // ====== ELEMENTOS ======
    const areasGrid = document.getElementById('areasGrid');
    const scoresGrid = document.getElementById('scoresGrid');
    const targetsGrid = document.getElementById('targetsGrid');
    const canvas = document.getElementById('wheelCanvas');
    const sizeSelect = document.getElementById('sizeSelect');
    const downloadBtn = document.getElementById('downloadBtn');
    const downloadBtn2 = document.getElementById('downloadBtn2');

    // ====== RENDER UI ======
    function renderAreas(){
      areasGrid.innerHTML = '';
      for(let i=0;i<8;i++){
        const wrap = document.createElement('div');
        wrap.className = 'row';
        const dot = document.createElement('span');
        dot.className = 'dot';
        dot.style.backgroundColor = COLORS[i%COLORS.length];
        const input = document.createElement('input');
        input.type = 'text';
        input.placeholder = `Área ${i+1}`;
        input.value = areas[i] || '';
        input.addEventListener('input', e=>{ areas[i] = e.target.value; draw(); });
        wrap.append(dot,input);
        areasGrid.appendChild(wrap);
      }
    }

    function renderScores(){
      scoresGrid.innerHTML = '';
      for(let i=0;i<8;i++){
        const box = document.createElement('div');
        const top = document.createElement('div'); top.className='row'; top.style.justifyContent='space-between';
        const lab = document.createElement('span'); lab.textContent = areas[i] || `Área ${i+1}`;
        const val = document.createElement('span'); val.className='num'; val.textContent = scores[i];
        top.append(lab,val);
        const range = document.createElement('input');
        range.type='range'; range.min=0; range.max=10; range.step=1; range.value=scores[i];
        range.addEventListener('input', e=>{ scores[i] = clamp(+e.target.value,0,10); val.textContent = scores[i]; draw(); });
        box.append(top,range);
        scoresGrid.appendChild(box);
      }
    }

    function renderTargets(){
      targetsGrid.innerHTML = '';
      for(let i=0;i<8;i++){
        const box = document.createElement('div');
        const top = document.createElement('div'); top.className='row'; top.style.justifyContent='space-between';
        const lab = document.createElement('span'); lab.textContent = areas[i] || `Área ${i+1}`;
        const val = document.createElement('span'); val.className='num'; val.textContent = targets[i];
        top.append(lab,val);
        const range = document.createElement('input');
        range.type='range'; range.min=0; range.max=10; range.step=1; range.value=targets[i];
        range.addEventListener('input', e=>{ targets[i] = clamp(+e.target.value,0,10); val.textContent = targets[i]; draw(); });
        box.append(top,range);
        targetsGrid.appendChild(box);
      }
    }

    // ====== DIBUJO ======
    function draw(){
      const dpi = window.devicePixelRatio || 1;
      const base = 680;
      const w = base * scale * dpi;
      const h = base * scale * dpi;
      canvas.width = w; canvas.height = h;
      canvas.style.width = (base * scale) + 'px';
      canvas.style.height = (base * scale) + 'px';

      const ctx = canvas.getContext('2d');
      if(!ctx) return;
      ctx.clearRect(0,0,w,h);
      ctx.fillStyle = '#ffffff';
      ctx.fillRect(0,0,w,h);

      const outerMargin = 40 * dpi;
      const cx = w/2;
      const cy = h/2 + 10*dpi;
      const radius = Math.min(w,h)/2 - outerMargin;
      const levels = 10;
      const angleStep = Math.PI*2/8;

      // Título + fecha
      ctx.fillStyle = '#111827';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'top';
      ctx.font = `${16*dpi}px ui-sans-serif,system-ui`;
      const fecha = new Date().toLocaleDateString();
      ctx.fillText(`Mi Rueda de la Vida — ${fecha}`, w/2, 10*dpi);

      ctx.save();
      ctx.translate(cx,cy);

      // anillos
      ctx.strokeStyle = '#E5E7EB';
      for(let l=1;l<=levels;l++){
        ctx.beginPath();
        ctx.arc(0,0,(radius*l)/levels,0,Math.PI*2);
        ctx.stroke();
      }
      // divisiones
      for(let i=0;i<8;i++){
        const a0 = -Math.PI/2 + i*angleStep;
        const x = Math.cos(a0)*radius; const y = Math.sin(a0)*radius;
        ctx.beginPath(); ctx.moveTo(0,0); ctx.lineTo(x,y); ctx.stroke();
      }

      // marcas 10 y 5
      ctx.fillStyle = '#6B7280';
      ctx.textAlign = 'right'; ctx.textBaseline='middle';
      ctx.font = `${12*dpi}px ui-sans-serif,system-ui`;
      ctx.fillText('10', -6*dpi, -(radius+12*dpi));
      ctx.fillText('5', -6*dpi, -(radius/2+12*dpi));

      // sectores
      for(let i=0;i<8;i++){
        const color = COLORS[i%COLORS.length];
        const aStart = -Math.PI/2 + i*angleStep;
        const aEnd = aStart + angleStep;
        const rVal = (radius * clamp(scores[i],0,10)) / 10;

        // fondo suave
        ctx.beginPath(); ctx.moveTo(0,0); ctx.arc(0,0,radius,aStart,aEnd); ctx.closePath();
        ctx.fillStyle = hexToRgba(color,0.12); ctx.fill();
        // relleno valor
        ctx.beginPath(); ctx.moveTo(0,0); ctx.arc(0,0,rVal,aStart,aEnd); ctx.closePath();
        ctx.fillStyle = hexToRgba(color,0.55); ctx.fill();

        // punto de objetivo
        const mid = aStart + angleStep/2;
        const rt = (radius * clamp(targets[i],0,10)) / 10;
        const tx = Math.cos(mid)*rt; const ty = Math.sin(mid)*rt;
        ctx.beginPath(); ctx.arc(tx,ty,4*dpi,0,Math.PI*2); ctx.fillStyle=color; ctx.fill();
        ctx.beginPath(); ctx.arc(tx,ty,6*dpi,0,Math.PI*2); ctx.lineWidth=2*dpi; ctx.strokeStyle=color; ctx.stroke();
      }

      // etiquetas (si están a la izquierda, gira 180º para que no queden boca abajo)
      for(let i=0;i<8;i++){
        const aStart = -Math.PI/2 + i*angleStep;
        const mid = aStart + angleStep/2;
        const labelR = radius + 20*dpi;
        const lx = Math.cos(mid)*labelR; const ly = Math.sin(mid)*labelR;
        const label = areas[i] || `Área ${i+1}`;
        ctx.fillStyle='#111827'; ctx.font = `${14*dpi}px ui-sans-serif,system-ui`;
        drawWrappedText(ctx,label,lx,ly,120*dpi,16*dpi,mid);
      }

      // leyenda objetivo
      ctx.textAlign='center'; ctx.textBaseline='alphabetic'; ctx.font = `${12*dpi}px ui-sans-serif,system-ui`; ctx.fillStyle='#374151';
      ctx.fillText(`Objetivos a ${horizon} meses (●)`,0,radius+48*dpi);

      ctx.restore();
    }

    // ====== HELPERS ======
    function clamp(n,min=0,max=10){ return Math.max(min, Math.min(max, Number.isFinite(n)?n:0)); }
    function hexToRgba(hex,alpha=1){
      const h = hex.replace('#','');
      const v = parseInt(h.length===3 ? h.split('').map(c=>c+c).join('') : h,16);
      const r=(v>>16)&255, g=(v>>8)&255, b=v&255; return `rgba(${r},${g},${b},${alpha})`;
    }
    function drawWrappedText(ctx,text,x,y,maxWidth,lineHeight,angle){
      ctx.save(); ctx.translate(x,y);
      const deg = angle*180/Math.PI; if(deg>90 && deg<270){ ctx.rotate(Math.PI); }
      ctx.textAlign='center'; ctx.textBaseline='middle';
      const words = String(text||'').split(/\s+/); let line=''; const lines=[];
      for(let n=0;n<words.length;n++){
        const test = line? line+' '+words[n] : words[n];
        const w = ctx.measureText(test).width;
        if(w>maxWidth && n>0){ lines.push(line); line = words[n]; } else { line = test; }
      }
      if(line) lines.push(line);
      const totalH = lines.length*lineHeight; let yy = -totalH/2 + lineHeight/2;
      for(const ln of lines){ ctx.fillText(ln,0,yy); yy+=lineHeight; }
      ctx.restore();
    }
    function safeFileName(name){ return (name||'rueda').replace(/[^a-z0-9\-_.]+/gi,'_').slice(0,60); }
    function downloadPNG(){
      const dataUrl = canvas.toDataURL('image/png');
      const a = document.createElement('a');
      const fecha = new Date().toISOString().slice(0,10);
      a.href = dataUrl; a.download = `${safeFileName('Rueda_de_la_Vida')}_${fecha}.png`;
      document.body.appendChild(a); a.click(); a.remove();
    }

    // ====== EVENTOS ======
    document.querySelectorAll('[data-preset]').forEach(btn=>{
      btn.addEventListener('click',()=>{
        const key = btn.getAttribute('data-preset');
        const preset = DEFAULTS[key] || [];
        areas = preset.slice(0,8);
        while(areas.length<8) areas.push('');
        renderAreas(); renderScores(); renderTargets(); draw();
      })
    });

    document.getElementById('all0').addEventListener('click',()=>{ scores = Array(8).fill(0); renderScores(); draw(); });
    document.getElementById('all5').addEventListener('click',()=>{ scores = Array(8).fill(5); renderScores(); draw(); });
    document.getElementById('all10').addEventListener('click',()=>{ scores = Array(8).fill(10); renderScores(); draw(); });

    document.getElementById('targets10').addEventListener('click',()=>{ targets = Array(8).fill(10); renderTargets(); draw(); });
    document.getElementById('targets7').addEventListener('click',()=>{ targets = Array(8).fill(7); renderTargets(); draw(); });

    sizeSelect.addEventListener('change', e=>{ scale = parseFloat(e.target.value)||1.2; draw(); });
    document.getElementById('horizon').addEventListener('change', e=>{ horizon = e.target.value; draw(); });

    downloadBtn.addEventListener('click', downloadPNG);
    downloadBtn2.addEventListener('click', downloadPNG);

    // ====== INIT ======
    renderAreas(); renderScores(); renderTargets(); draw();
  </script>
</body>
</html>
